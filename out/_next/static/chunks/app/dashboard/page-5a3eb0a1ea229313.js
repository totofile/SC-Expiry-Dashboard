(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2641:function(e,t,a){Promise.resolve().then(a.bind(a,4866))},1516:function(e,t,a){"use strict";a.d(t,{H:function(){return s},a:function(){return u}});var i=a(7437),r=a(2265),n=a(4766),l=a(6504),o={clientId:"daf4c825-110a-4385-a469-916c272ae5c3",authority:"https://login.microsoftonline.com/f43e2fea-8e52-469a-a796-56e4c4bcb1f5/",redirectUri:"http://localhost:3000/"};let c=(0,r.createContext)(void 0),s=e=>{let{children:t}=e,[a,s]=(0,r.useState)(!1),u=(0,r.useRef)(null);(0,r.useEffect)(()=>{(async()=>{try{u.current=new n.Lx({auth:{clientId:o.clientId,authority:o.authority,redirectUri:o.redirectUri},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!0}}),await u.current.initialize();let e={scopes:["Directory.Read.All"],account:u.current.getAllAccounts()[0]||void 0};try{let t=await u.current.ssoSilent(e);console.log("SSO Silent successful",t),s(!0)}catch(e){e instanceof l.Ut&&"login_required"===e.errorCode?u.current.getAllAccounts().length>0&&s(!0):console.warn("SSO Silent failed, user interaction required",e)}}catch(e){console.error("MSAL initialization failed",e)}})()},[]);let d=async()=>{console.log("Login button clicked");try{var e;await (null===(e=u.current)||void 0===e?void 0:e.loginPopup({scopes:["Directory.Read.All"]})),console.log("Login successful"),s(!0)}catch(e){console.error("Login failed",e)}},p=async()=>{u.current&&(await u.current.logoutPopup().catch(e=>console.error("Logout failed",e)),s(!1),u.current=null,window.location.reload())};return(0,i.jsx)(c.Provider,{value:{isAuth:a,login:d,logout:p,publicClientAppRef:u},children:t})},u=()=>{let e=(0,r.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4866:function(e,t,a){"use strict";a.d(t,{default:function(){return y}});var i=a(7437),r=a(2265),n=a(6463),l=a(2392),o=a(2873),c=a(5954);let s=e=>new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}),u=e=>{let t=new Date(e),a=new Date;return Math.ceil((t.getTime()-a.getTime())/864e5)},d=async e=>{try{return(await e.api("/applications").get()).value}catch(e){return console.error("Fetching applications failed",e),[]}},p=async(e,t)=>{try{let a=t.map(async t=>{let a=await e.api("/applications/".concat(t.id,"/passwordCredentials")).get();return{...t,secrets:a.value}});return await Promise.all(a)}catch(e){return console.error("Fetching secrets failed",e),[]}},f=async(e,t)=>{try{let a=t.map(async t=>{let a=await e.api("/applications/".concat(t.id,"/keyCredentials")).get();return{...t,certificates:a.value}});return await Promise.all(a)}catch(e){return console.error("Fetching certificates failed",e),[]}};var h=a(1066);a(9730),a(8598);var m=a(1516),y=()=>{let{isAuth:e,publicClientAppRef:t}=(0,m.a)(),[a,y]=(0,r.useState)([]),[g,x]=(0,r.useState)(30),[w,N]=(0,r.useState)(!0),v=(0,n.useRouter)();(0,r.useEffect)(()=>{console.log("isAuth:",e),e?b():N(!1)},[e,g]);let b=async()=>{if(!t.current)return;let e=t.current.getAllAccounts()[0];if(!e){console.error("No account found"),N(!1);return}try{let a=new c.AuthCodeMSALBrowserAuthenticationProvider(t.current,{account:e,scopes:["Directory.Read.All"],interactionType:l.s_.Popup}),i=o.KU.initWithMiddleware({authProvider:a}),r=await d(i);console.log("Applications:",r);let[n,s]=await Promise.all([p(i,r),f(i,r)]);console.log("Applications with Secrets:",n),console.log("Applications with Certificates:",s);let u=D(r,n,s);console.log("Flattened Data:",u),y(u)}catch(e){console.error("Fetching data failed",e)}finally{N(!1)}},D=(e,t,a)=>{let i=[];return e.forEach(e=>{let r=t.find(t=>t.id===e.id)||{secrets:[]},n=a.find(t=>t.id===e.id)||{certificates:[]};r.secrets.forEach(t=>{u(t.endDateTime)<=g&&i.push({applicationName:e.displayName,type:"secret",displayName:t.displayName,endDateTime:t.endDateTime,daysToExpiry:u(t.endDateTime)})}),n.certificates.forEach(t=>{u(t.endDateTime)<=g&&i.push({applicationName:e.displayName,type:"certificate",displayName:t.displayName,endDateTime:t.endDateTime,daysToExpiry:u(t.endDateTime)})})}),i};return w?(0,i.jsx)("div",{children:"Loading..."}):e?(0,i.jsx)("div",{children:(0,i.jsxs)("div",{className:"text-lg mx-20",children:[(0,i.jsx)("div",{className:"flex justify-between items-center bg-cyan-500 text-black text-center rounded p-4 mx-auto mt-10 mb-10",children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("p",{className:"mr-5",children:"Days to Expiry"}),(0,i.jsx)("input",{className:"border rounded",type:"number",placeholder:"Default: 30",onChange:e=>x(Number(e.target.value))})]})}),(0,i.jsx)("div",{className:"ag-theme-alpine",style:{height:"100%",width:"100%"},children:(0,i.jsx)(h.s,{rowData:a,columnDefs:[{headerName:"Secret/Certificate Display Name",field:"displayName",flex:1,resizable:!0,sortable:!0,filter:"agTextColumnFilter"},{headerName:"Type",field:"type",flex:1,resizable:!0,sortable:!0,filter:"agTextColumnFilter"},{headerName:"Application Name",field:"applicationName",sortable:!0,filter:"agTextColumnFilter",flex:1,resizable:!0},{headerName:"End Date",field:"endDateTime",sortable:!0,flex:1,resizable:!0,valueFormatter:e=>s(e.value)},{headerName:"Days To Expiry",field:"daysToExpiry",cellDataType:"number",flex:1,resizable:!0,sortable:!0,filter:"agNumberColumnFilter"}],domLayout:"autoHeight",pagination:!0,paginationPageSize:10})})]})}):(v.push("/"),null)}}},function(e){e.O(0,[417,661,314,977,766,981,971,23,744],function(){return e(e.s=2641)}),_N_E=e.O()}]);